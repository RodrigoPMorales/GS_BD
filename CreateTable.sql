-- Create Tables
-- USERS
CREATE TABLE TB_GS_USERS (
    ID_USER NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USERNAME VARCHAR2(50) NOT NULL UNIQUE,
    EMAIL VARCHAR2(100) NOT NULL UNIQUE,
    PASSWORD VARCHAR2(100) NOT NULL,
    FULLNAME VARCHAR2(100),
    PHONE VARCHAR2(20),
    ROLE VARCHAR2(20)
);

-- SECTORS 
CREATE TABLE TB_GS_SECTORS (
    ID_SECTOR NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR2(100) NOT NULL,
    DESCRIPTION VARCHAR2(200),
    SUPERVISOR_ID NUMBER,
    CONSTRAINT FK_GS_SECTOR_USER
        FOREIGN KEY (SUPERVISOR_ID) REFERENCES TB_GS_USERS(ID_USER)
);




-- SENSORS
CREATE TABLE TB_GS_SENSORS (
    ID_SENSOR NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    SECTOR_ID NUMBER NOT NULL,
    NAME VARCHAR2(100),
    TYPE VARCHAR2(50),
    CONSTRAINT FK_GS_SENSOR_SECTOR
        FOREIGN KEY (SECTOR_ID) REFERENCES TB_GS_SECTORS(ID_SECTOR)
);

-- SENSOR READINGS
CREATE TABLE TB_GS_SENSOR_READINGS (
    ID_READING NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    SENSOR_ID NUMBER NOT NULL,
    TEMPERATURE NUMBER(10,2),
    HUMIDITY NUMBER(10,2),
    RAINFALL NUMBER(10,2),
    LIGHT NUMBER(10,2),
    WIND_SPEED NUMBER(10,2),
    SOIL_MOISTURE NUMBER(10,2),
    READING_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_GS_READING_SENSOR
        FOREIGN KEY (SENSOR_ID) REFERENCES TB_GS_SENSORS(ID_SENSOR)
);

-- NOTIFICATIONS
CREATE TABLE TB_GS_NOTIFICATIONS (
    ID_NOTIFICATION NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TITLE VARCHAR2(200) NOT NULL,
    DESCRIPTION VARCHAR2(1000) NOT NULL,
    METRIC VARCHAR2(100) NOT NULL,
    MEASURED_VALUE NUMBER(10,2),
    THRESHOLD_VALUE NUMBER(10,2),
    STATUS VARCHAR2(20) DEFAULT 'PENDING' NOT NULL,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    READ_AT TIMESTAMP,
    USER_ID NUMBER NOT NULL,
    SECTOR_ID NUMBER NOT NULL,
    
    CONSTRAINT FK_NOTIFICATION_USER
        FOREIGN KEY (USER_ID) REFERENCES TB_GS_USERS(ID_USER),

    CONSTRAINT FK_NOTIFICATION_SECTOR
        FOREIGN KEY (SECTOR_ID) REFERENCES TB_GS_SECTORS(ID_SECTOR)
);


-- Drop Table
DROP TABLE TB_GS_NOTIFICATIONS CASCADE CONSTRAINTS;
DROP TABLE TB_GS_SENSOR_READINGS CASCADE CONSTRAINTS;
DROP TABLE TB_GS_SENSORS CASCADE CONSTRAINTS;
DROP TABLE TB_GS_SECTORS CASCADE CONSTRAINTS;
DROP TABLE TB_GS_USERS CASCADE CONSTRAINTS;
